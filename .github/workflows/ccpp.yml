name: github-ci
on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Install boost
        uses:  MarkusJx/install-boost@v2.4.1
        id: install-boost
        with:
          # REQUIRED: Specify the required boost version
          # A list of supported versions can be found here:
          # https://github.com/actions/boost-versions/blob/main/versions-manifest.json
          boost_version: 1.81.0
          # OPTIONAL: Specify a platform version
          platform_version: 22.04

          # NOTE: If a boost version matching all requirements cannot be found,
          # this build step will fail

      - name: Install gtk
        run: sudo apt-get update && sudo apt-get install liblzma5 libjbig0 libgtk-3-dev

      - name: Install gcc
        run: sudo apt-get install -yq gcc-12 g++-12

      - name: Configure
        run: export CC=gcc-12 && export CXX=g++-12 && mkdir build && cd build && cmake -DBoost_INCLUDE_DIR=${{steps.install-boost.outputs.BOOST_ROOT}}/include -DBoost_LIBRARY_DIRS=${{steps.install-boost.outputs.BOOST_ROOT}}/lib ..

      - name: Make
        run: cd build && make

      - name: Test
        run: cd build && ctest -VV

version: 17.10.0.{build}

branches:
  only:
    - master

clone_folder: c:\projects\wxex

configuration:
  - Release

install:
  - git submodule init && git submodule update --init --recursive
  - ps: Start-FileDownload 'http://sourceforge.net/projects/syncped/files/wxWidgets-3.1.1-include.7z'
  - ps: Start-FileDownload 'http://sourceforge.net/projects/syncped/files/wxWidgets-3.1.1-lib.7z'
  - ps: Start-FileDownload 'http://sourceforge.net/projects/syncped/files/wxWidgets-3.1.1-locale.7z'
  - cmd: 7z x wxWidgets-3.1.1-include.7z -oC:\wxWidgets
  - cmd: 7z x wxWidgets-3.1.1-lib.7z -oC:\wxWidgets\lib
  - cmd: 7z x wxWidgets-3.1.1-locale.7z -oC:\wxWidgets

before_build:
  - mkdir build
  - ps: cd build

build_script:
  - echo "PLATFORM = %PLATFORM%"
  - echo "WXLIBFOLDER = %WXLIBFOLDER%"
  - if /I "%PLATFORM%" == "Win32" call "c:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat"
  - if /I "%PLATFORM%" == "x64" call "c:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
  - if /I "%PLATFORM%" == "Win32" SET WXLIBFOLDER=vc_lib
  - if /I "%PLATFORM%" == "x64" SET WXLIBFOLDER=vc_x64_lib
  - cmake -G "NMake Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_PROGRAM_PATH=C:\cygwin\bin DBUILD_TEST=ON -DENABLE_GETTEXT=ON ..
  - nmake
  - ..\ci\pack.bat

test: OFF

artifacts:
  - path: 'build\syncped-v17.10.0.zip'

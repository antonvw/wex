version: 20.04.0.{build}

clone_folder: c:\projects\wex

clone_depth: 250

environment:
  matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
    BOOST: 69
    YEAR: 2017

  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
    BOOST: 71
    YEAR: 2019

configuration: 
  - Release

install:
  - git config http.postBuffer 1048576000
  - git submodule init && git submodule update --init --recursive

before_build:
  - mkdir build && cd build

build_script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\%YEAR%\Community\VC\Auxiliary\Build\vcvars32.bat"
  - set CL=/Zc:__cplusplus
  - cmake -DBOOST_ROOT=C:\Libraries\boost_1_%BOOST%_0 -DCMAKE_BUILD_TYPE=%configuration% -DwexBUILD_TESTS=ON -DENABLE_GETTEXT=ON ..
  - echo %configuration%
  - devenv wex.sln /Build %configuration%
#  - devenv wex.sln /Build Release /project RUN_TESTS
  - ..\ci\pack.bat

test: OFF

artifacts:
  # In common.cmake the artifact is generated.
  - path: 'build\syncped-v20.4.0.zip'
